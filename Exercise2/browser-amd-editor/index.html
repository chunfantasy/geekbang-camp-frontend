<!DOCTYPE html>
<html>
	<head>
		<title>browser-amd-editor</title>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	</head>
	<body>
		<h2>Monaco Editor Sample</h2>
		<div id="container" style="width: 800px; height: 600px; border: 1px solid grey"></div>
		<input type="file" id="files" name="files[]" multiple />
		<input type="button" id="save" name="save" value="Save as file" />

		<!-- OR ANY OTHER AMD LOADER HERE INSTEAD OF loader.js -->
		<script src="../node_modules/monaco-editor/min/vs/loader.js"></script>
		<script>
			require.config({ paths: { vs: '../node_modules/monaco-editor/min/vs' } });
			var content;
			var fileName;
			var fileType;

			function handleFileSelect(evt) {
				var file = evt.target.files[0]; // Only get the first file for simple demo
				console.log(file);
				var reader = new FileReader();
				reader.onload = function(readerEvt) {
					console.log(readerEvt.target.result);
					content = readerEvt.target.result;
					fileType =  file.type;
					fileName =  file.name;

					require(['vs/editor/editor.main'], function () {
						var editor = monaco.editor.create(document.getElementById('container'), {
							value: [content].join('\n'),
							language: 'javascript'
						});
						editor.onDidChangeModelContent(function (evt) {
							content = editor.getValue();
						});
					});

				};
				reader.readAsText(file);
			}

			function handleFileSave(evt) {
				console.log(content);
				console.log(evt);
				var a = document.createElement('a');
				var fileToSave = new Blob([content], { type: fileType })
				a.href = URL.createObjectURL(fileToSave);
				a.download = fileName;
				a.click();
				URL.revokeObjectURL(a.href);
			}

			document.getElementById('files').addEventListener('change', handleFileSelect, false);
			document.getElementById('save').addEventListener('click', handleFileSave, false);
		</script>
	</body>
</html>
